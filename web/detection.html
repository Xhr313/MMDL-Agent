<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Detection - MMDL-Agent</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/detection-form.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; padding: 0 20px; width: 100%;">
            <div style="display: flex; align-items: center; gap: 20px; flex: 1;">
                <h1 style="margin: 0; font-size: 1.5rem; color: #2563eb;">üîç MMDL-Agent</h1>
                <span style="font-size: 0.9rem; color: #888;">Industrial Anomaly Detection</span>
            </div>
            <div style="display: flex; gap: 20px;">
                <a href="index.html" style="color: #666; text-decoration: none;">Dashboard</a>
                <a href="detection.html" style="color: #2563eb; text-decoration: none; font-weight: 500;">Detection</a>
                <a href="#" style="color: #666; text-decoration: none;">Status</a>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <header style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 20px; text-align: center;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <h1 style="margin: 0 0 10px 0; font-size: 2rem;">Create Detection Task</h1>
            <p style="margin: 10px 0 0 0; opacity: 0.95;">Configure and run anomaly detection analysis</p>
        </div>
    </header>

    <!-- Main Content -->
    <main style="max-width: 900px; margin: 0 auto; padding: 40px 20px;">
        <!-- Error Message -->
        <div id="error-message" style="
            display: none;
            padding: 15px;
            background: #fee2e2;
            border-left: 4px solid #dc2626;
            border-radius: 6px;
            color: #991b1b;
            margin-bottom: 20px;
        "></div>

        <!-- Detection Form -->
        <form id="detection-form" style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); margin-bottom: 30px;">
            <h2 style="margin-top: 0; margin-bottom: 25px; color: #1f2937;">Task Configuration</h2>

            <!-- Task ID -->
            <div class="form-group">
                <label for="task-id">Task ID *</label>
                <input 
                    type="text" 
                    id="task-id" 
                    name="task_id" 
                    placeholder="Auto-generated unique identifier"
                    readonly
                    style="background: #f8fafc;"
                >
                <small style="color: #666;">Automatically generated unique identifier</small>
            </div>

            <!-- Asset ID -->
            <div class="form-group">
                <label for="asset-id">Asset ID *</label>
                <input 
                    type="text" 
                    id="asset-id" 
                    name="asset_id" 
                    placeholder="e.g., PUMP-001, MOTOR-02"
                    required
                >
                <small style="color: #666;">The asset or equipment being monitored</small>
            </div>

            <!-- Data Source -->
            <div class="form-group">
                <label for="data-source">Data Source</label>
                <select id="data-source" name="data_source">
                    <option value="manual">Manual Input</option>
                    <option value="sensor">Sensor Feed</option>
                    <option value="database">Database</option>
                    <option value="api">External API</option>
                </select>
            </div>

            <!-- Time Range -->
            <div class="form-row">
                <div class="form-group">
                    <label for="start-time">Start Time *</label>
                    <input 
                        type="datetime-local" 
                        id="start-time" 
                        name="start_time"
                        required
                    >
                </div>
                <div class="form-group">
                    <label for="end-time">End Time *</label>
                    <input 
                        type="datetime-local" 
                        id="end-time" 
                        name="end_time"
                        required
                    >
                </div>
            </div>

            <!-- Detection Data -->
            <div class="form-group">
                <label for="data-input">Detection Data *</label>
                <textarea 
                    id="data-input" 
                    name="data" 
                    placeholder="Enter numerical data (comma-separated or JSON array)"
                    rows="6"
                    required
                ></textarea>
                <small style="color: #666;">
                    Example: <code>10.5, 20.3, 15.8, 100.2, 12.1</code> 
                    or <code>[10.5, 20.3, 15.8]</code>
                </small>
            </div>

            <!-- Threshold Slider -->
            <div class="form-group">
                <label for="threshold-slider">Anomaly Threshold</label>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <input 
                        type="range" 
                        id="threshold-slider" 
                        class="threshold-input" 
                        min="0" 
                        max="1" 
                        step="0.01" 
                        value="0.5"
                    >
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span style="font-size: 1.2rem; font-weight: 600; color: #2563eb; min-width: 50px;">
                            <span id="threshold-value">0.50</span>
                        </span>
                        <input 
                            type="number" 
                            id="threshold-input" 
                            value="0.5" 
                            min="0" 
                            max="1" 
                            step="0.01"
                            style="width: 60px;"
                            readonly
                        >
                    </div>
                </div>
                <small style="color: #666;">
                    Lower values (green) ‚Üí more sensitive | Higher values (red) ‚Üí less sensitive
                </small>
            </div>

            <!-- Submit Button -->
            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button type="submit" class="btn btn-primary" style="flex: 1;">
                    üöÄ Run Detection
                </button>
                <button type="reset" class="btn btn-outline" onclick="resetForm()" style="flex: 1;">
                    ‚Üª Clear Form
                </button>
            </div>
        </form>

        <!-- Results Section -->
        <div id="results-section" style="display: none;">
            <div id="result-card" style="
                background: white;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            "></div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        gap: 20px;
    ">
        <div class="spinner"></div>
        <p style="color: white; font-size: 1.1rem;">Processing detection task...</p>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 MMDL-Agent. All rights reserved.</p>
    </footer>

    <!-- API Client -->
    <script src="assets/js/api-client.js"></script>
    <!-- Detection Form Script -->
    <script src="assets/js/detection-form.js"></script>
</body>
</html>
